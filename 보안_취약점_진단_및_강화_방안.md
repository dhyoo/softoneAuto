# Java Swing 애플리케이션 보안 취약점 진단 및 강화 방안

## 개요
본 문서는 아이디/패스워드 인증이 없는 Java Swing 애플리케이션의 보안 취약점을 진단하고, 세 가지 핵심 영역에 대한 강화 방안을 제시합니다.

---

## 1. 민감 정보 노출 방지

### 1.1 현재 취약점 분석

#### 🔴 **심각: 평문 저장된 설정 정보**

**발견 위치:**
- `config.json`: 데이터 경로, 회사 ID 등이 평문으로 저장
- `settings.json`: 데이터 디렉토리 경로가 평문으로 저장
- `config.properties`: 데이터 경로가 평문으로 저장

**위험성:**
```json
// config.json 예시
{
  "dataPath": "C:\\Users\\ydh10\\SoftOneAutoData",
  "lastCompanyId": "company-123",
  "darkMode": false
}
```

- 파일 시스템 경로 노출
- 사용자 디렉토리 구조 노출
- 향후 API 키나 비밀번호 추가 시 평문 저장 위험

**공격 시나리오:**
1. 공격자가 설정 파일에 접근
2. 민감한 경로 정보 획득
3. 데이터 파일 직접 접근 시도
4. 향후 추가될 API 키나 비밀번호 탈취

### 1.2 강화 방안: JCE 기반 암호화

#### ✅ **해결책 1: AES-256-GCM 암호화 구현**

**구현 클래스:** `SecureConfigManager.java`

**특징:**
- **AES-256-GCM**: 인증된 암호화(Authenticated Encryption) 제공
- **PBKDF2**: 비밀번호 기반 키 파생 (10,000회 반복)
- **랜덤 IV**: 각 암호화마다 고유한 초기화 벡터 사용
- **GCM 모드**: 무결성 검증 포함

**암호화 대상:**
- 데이터 경로
- API 키 (향후 추가 시)
- 기타 민감한 설정값

**키 관리:**
- 마스터 키는 사용자 환경 변수나 시스템 속성에서 파생
- 키는 메모리에만 보관, 평문으로 저장하지 않음

---

## 2. 코드 난독화 및 리버스 엔지니어링 방지

### 2.1 현재 취약점 분석

#### 🔴 **심각: 난독화 미적용**

**현재 상태:**
- `build.gradle`에 난독화 설정 없음
- 컴파일된 `.jar` 파일이 쉽게 디컴파일 가능
- 클래스명, 메서드명, 변수명이 그대로 노출

**위험성:**
```java
// 디컴파일된 코드 예시
public class WeeklyReportService {
    private final WeeklyReportRepository repository;
    
    public List<WeeklyReport> getAllReports() {
        // 내부 로직이 그대로 노출됨
    }
}
```

**공격 시나리오:**
1. 공격자가 `.jar` 파일 획득
2. JD-GUI, jadx 등 도구로 디컴파일
3. 비즈니스 로직 분석
4. 취약점 발견 및 악용
5. 암호화 키나 알고리즘 노출

### 2.2 강화 방안: ProGuard 난독화

#### ✅ **해결책: ProGuard 통합**

**특징:**
- 클래스명, 메서드명, 변수명 난독화
- 사용하지 않는 코드 제거 (코드 축소)
- 리플렉션 사용 코드 보호
- 라이브러리 난독화 지원

---

## 3. 외부 입력 검증 (Input Validation)

### 3.1 현재 취약점 분석

#### 🔴 **심각: Path Traversal 취약점**

**발견 위치:**
- `AppConfig.java:143`: 사용자 입력 경로가 직접 사용됨
- `DataPathManager.java:40`: 회사 ID가 경로에 직접 포함
- `WeeklyReportRepository.java:221`: 날짜 기반 경로 생성

**위험 코드:**
```java
// AppConfig.java
String selectedPath = fileChooser.getSelectedFile().getAbsolutePath();
// 검증 없이 직접 사용

// DataPathManager.java
String companyPath = basePath + File.separator + "companies" + 
                     File.separator + companyId;
// companyId 검증 없음
```

**공격 시나리오:**
```
악의적 입력: "../../../Windows/System32"
결과 경로: C:\Users\...\Windows\System32
→ 시스템 파일 접근 가능
```

#### 🔴 **심각: OS Command Injection 취약점**

**발견 위치:**
- `SoftoneApplication.java:163, 218`: ProcessBuilder 사용

**위험 코드:**
```java
ProcessBuilder pb = new ProcessBuilder(
    "tasklist", "/FI", "PID eq " + processId
);
```

**현재 상태:**
- `processId`는 내부에서 생성되므로 직접적인 위험은 낮음
- 하지만 사용자 입력이 ProcessBuilder에 전달될 경우 심각한 취약점

#### 🟡 **중간: SQL Injection (현재는 JSON 저장소 사용)**

**현재 상태:**
- JSON 파일 기반 저장소 사용으로 SQL Injection 위험은 낮음
- 향후 데이터베이스 도입 시 위험 가능

### 3.2 강화 방안: 강력한 입력 검증

#### ✅ **해결책 1: Path Traversal 방지**

**구현 클래스:** `PathSecurityValidator.java`

**검증 항목:**
- `..` (상위 디렉토리) 차단
- 절대 경로 차단 (상대 경로만 허용)
- 특수 문자 필터링
- 화이트리스트 기반 허용 문자
- 정규화 후 검증

#### ✅ **해결책 2: OS Command Injection 방지**

**구현 클래스:** `CommandSecurityValidator.java`

**검증 항목:**
- 명령어 분리자 차단 (`;`, `|`, `&`, `&&`, `||`)
- 리다이렉션 문자 차단 (`>`, `<`, `>>`)
- 백틱(`) 및 명령 치환 차단
- 화이트리스트 기반 허용 명령어만 실행

#### ✅ **해결책 3: 통합 입력 검증 유틸리티**

**기존 `InputValidator.java` 확장:**
- 파일 경로 검증 메서드 추가
- 명령어 인젝션 검증 메서드 추가
- 정규식 기반 패턴 검증 강화

---

## 4. 종합 보안 강화 구현

### 4.1 구현 우선순위

#### 🔴 **최우선 (Critical)**
1. **민감 정보 암호화**
   - `SecureConfigManager` 구현
   - 기존 설정 파일 마이그레이션

2. **Path Traversal 방지**
   - `PathSecurityValidator` 구현
   - 모든 파일 경로 사용 지점에 검증 추가

3. **입력 검증 강화**
   - `InputValidator` 확장
   - 모든 사용자 입력 지점에 검증 적용

#### 🟡 **중요 (High)**
4. **코드 난독화**
   - ProGuard 설정 추가
   - 빌드 프로세스에 통합

5. **OS Command Injection 방지**
   - `CommandSecurityValidator` 구현
   - ProcessBuilder 사용 지점 보안 강화

#### 🟢 **권장 (Medium)**
6. **로깅 보안**
   - 민감 정보 로그 출력 방지
   - 보안 이벤트 로깅

7. **파일 권한 관리**
   - 설정 파일 접근 권한 제한
   - 암호화된 파일 보호

---

## 5. 보안 체크리스트

### 5.1 적용 전 체크리스트

- [ ] 기존 설정 파일 백업
- [ ] 암호화 키 관리 전략 수립
- [ ] 테스트 환경 구축
- [ ] 마이그레이션 계획 수립

### 5.2 적용 후 검증 항목

- [ ] 설정 파일이 암호화되어 저장되는지 확인
- [ ] 암호화된 설정 파일이 정상적으로 로드되는지 확인
- [ ] Path Traversal 공격 시도 시 차단되는지 확인
- [ ] 난독화된 JAR 파일이 정상 실행되는지 확인
- [ ] 성능 영향 측정 (암호화/복호화 오버헤드)

---

## 6. 참고 자료

### 6.1 Java 보안 API 문서
- [Java Cryptography Architecture (JCA)](https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html)
- [Java Cryptography Extension (JCE)](https://docs.oracle.com/javase/8/docs/technotes/guides/security/jce/JCERefGuide.html)

### 6.2 ProGuard 문서
- [ProGuard Manual](https://www.guardsquare.com/manual/home)

### 6.3 보안 가이드라인
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CWE-22: Path Traversal](https://cwe.mitre.org/data/definitions/22.html)
- [CWE-78: OS Command Injection](https://cwe.mitre.org/data/definitions/78.html)

---

**작성일:** 2025-01-XX  
**분석 대상:** `softoneAuto` Java Swing 애플리케이션  
**분석 범위:** 민감 정보 저장, 코드 난독화, 입력 검증

